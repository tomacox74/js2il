{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/tomacox74/js2il/raw/master/docs/ECMA262/SectionDoc.schema.json",
  "title": "JS2IL ECMA-262 section/subsection documentation",
  "type": "object",
  "additionalProperties": false,
  "required": ["clause", "title", "status", "specUrl"],
  "$defs": {
    "status": {
      "type": "string",
      "enum": ["Untracked", "Not Yet Supported", "Partially Supported", "Supported"],
      "description": "Support status used throughout docs."
    },
    "supportEntry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["clause", "feature", "status"],
      "properties": {
        "clause": {
          "type": "string",
          "pattern": "^\\d+(\\.\\d+)+$",
          "description": "Spec clause number for the feature (can be deeper than the subsection, e.g. '6.1.4.1')."
        },
        "feature": {
          "type": "string",
          "minLength": 1,
          "description": "Feature name."
        },
        "status": {
          "$ref": "#/$defs/status"
        },
        "testScripts": {
          "type": "array",
          "description": "Optional list of JS test scripts that exercise this feature.",
          "items": { "type": "string" }
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about support status, limitations, or behavior."
        },
        "specUrl": {
          "type": "string",
          "format": "uri",
          "description": "Optional tc39.es link for the specific clause."
        }
      }
    },
    "support": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "entries": {
          "type": "array",
          "items": { "$ref": "#/$defs/supportEntry" }
        }
      }
    }
  },
  "properties": {
    "$schema": {
      "type": "string"
    },
    "autoGeneratedHeader": {
      "type": "boolean",
      "description": "When true, generator prepends an AUTO-GENERATED marker comment."
    },
    "clause": {
      "type": "string",
      "pattern": "^\\d+(\\.\\d+)?$",
      "description": "Spec clause number, e.g. '15' or '15.7'."
    },
    "title": {
      "type": "string",
      "minLength": 1
    },
    "status": {
      "$ref": "#/$defs/status"
    },
    "specUrl": {
      "type": "string",
      "format": "uri",
      "description": "Canonical tc39.es link to the clause anchor."
    },
    "parent": {
      "type": "object",
      "additionalProperties": false,
      "required": ["clause"],
      "properties": {
        "clause": {
          "type": "string",
          "pattern": "^\\d+$",
          "description": "Parent section number, e.g. '15'."
        },
        "doc": {
          "type": "string",
          "description": "Optional override for the parent hub doc filename (default: Section<parent>.md)."
        }
      }
    },
    "intro": {
      "type": "string",
      "description": "Optional short description shown near the top (freeform markdown)."
    },
    "subclauses": {
      "type": "array",
      "description": "Child clauses shown under 'Subclauses'.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["clause", "title", "status", "specUrl"],
        "properties": {
          "clause": {
            "type": "string",
            "pattern": "^\\d+(\\.\\d+)+$"
          },
          "title": {
            "type": "string",
            "minLength": 1
          },
          "status": {
            "$ref": "#/$defs/status"
          },
          "specUrl": {
            "type": "string",
            "format": "uri"
          }
        }
      }
    },
    "support": {
      "$ref": "#/$defs/support",
      "description": "Optional feature-level support/test metadata."
    },
    "reference": {
      "type": "object",
      "additionalProperties": false,
      "description": "Optional reference section generation.",
      "required": ["mode"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["none", "stub", "embedded"],
          "description": "none: omit entirely; stub: include heading + note; embedded: include a details block with embedded spec markdown."
        },
        "detailsSummary": {
          "type": "string",
          "description": "Used by mode=embedded. The <summary> text for the <details> block."
        },
        "note": {
          "type": "string",
          "description": "Used by mode=stub."
        },
        "convertedFromHtml": {
          "type": "string",
          "description": "Used by mode=embedded to document provenance (e.g. test_output/ecma262-15.7.html)."
        },
        "specMarkdownPath": {
          "type": "string",
          "description": "Used by mode=embedded; path to a markdown file to embed (relative to repo root)."
        }
      },
      "allOf": [
        {
          "if": { "properties": { "mode": { "const": "embedded" } } },
          "then": { "required": ["convertedFromHtml", "specMarkdownPath"] }
        }
      ]
    }
  }
}
